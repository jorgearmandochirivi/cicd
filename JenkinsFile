pipeline{
    agent any
    tools{
        nodejs "Node"
    }    

    stages{
        stage ("Checkout"){
            steps{
                checkout scm
            }
        }

        stage("install"){
            steps{
                git branch: 'main', url: 'https://github.com/jorgearmandochirivi/cicd.git'                
                sh 'npm install'                
            }
        } 
        stage("test"){
            steps{
                sh 'npm run test'
            }
        }

        stage("Build"){
            steps{
                sh 'npm run build'
            }
        }

         stage("Docker Image"){
            steps{
                sh 'docker build -t proyecto-diplomado:1.0 .'
            }
        }

        stage("Docker push"){
            steps{
                withCredentials([usernamePassword(credentialsId:'docker_cred', usernameVariable:'DOCKERHUB_USERNAME', passwordVariable:'DOCKERHUB_PASSWORD')]){
                  
                        sh 'docker login -u $DOCKERHUB_USERNAME -p $DOCKERHUB_PASSWORD'
                        sh 'docker tag proyecto-diplomado:1.0 jorgechirivi/proyecto-diplomado:1.0'
                        sh 'docker push jorgechirivi/proyecto-diplomado:1.0'
                        sh 'docker logout'
                    
                }
            }
        }


        
    }
}
    